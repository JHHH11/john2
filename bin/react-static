#!/usr/bin/env node

require('babel-register')
const chalk = require('chalk')
const fs = require('fs')
const commander = require('commander')
const pkg = require('../package.json')

// necesarry at any entry point of the cli to ensure that Babel-register
// does not attempt to transform non JavaScript files.
const ignoredExtensions = [
  'css',
  'scss',
  'styl',
  'less',
  'png',
  'gif',
  'jpg',
  'jpeg',
  'svg',
  'woff',
  'ttf',
  'eot',
  'otf',
  'mp4',
  'webm',
  'ogg',
  'mp3',
  'wav',
  'md',
  'yaml',
]
ignoredExtensions.forEach(ext => {
  require.extensions[`.${ext}`] = () => {}
})

// Be sure to log useful information about unhandled exceptions. This should seriously
// be a default: https://github.com/nodejs/node/issues/9523#issuecomment-259303079
process.on('unhandledRejection', r => {
  console.log('')
  console.log('UnhandledPromiseRejectionWarning: Unhandled Promise Rejection')
  console.log(r)
})

commander
  .version(pkg.version)
  .description(pkg.description)
  .command('create', 'create a new project')
  .command('start', 'start the development server')
  .command('build', 'build site for production')
  .on('--help', function() {
    console.log('')
    console.log(`  ${chalk.green('Examples:')}`)
    console.log('')
    console.log('    $ react-static create')
    console.log('    $ react-static start')
    console.log('    $ react-static build')
    console.log('')
    console.log('    $ react-static create -n my-static-app --t user/repo')

    console.log('')
  })
  .parse(process.argv)
